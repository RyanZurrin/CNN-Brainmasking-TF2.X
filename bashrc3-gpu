# new software developed by Tashrif Billah
# deactivates default bashrc
# sources new environment

# Source global definitions
if [ -f /etc/bashrc ]; then
    . /etc/bashrc
fi


# define new software directory
export NEW_SOFT_DIR=/rfanfs/pnl-zorro/software/pnlpipe3

# make commands/scripts visible from pnlpipe, pnlNipype, conversion, DCMTK, dcm2niix, mrtrix, cmake, git-lfs
user=`whoami`
export PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/opt/puppetlabs/bin:/home/$user/.local/bin:/home/$user/bin:\
${NEW_SOFT_DIR}/pnlNipype/scripts/:\
${NEW_SOFT_DIR}/pnlNipype/exec/:\
${NEW_SOFT_DIR}/conversion/conversion/:\
${NEW_SOFT_DIR}/pnlpipe/soft_dir/BRAINSTools-build/DCMTK-build/bin:\
${NEW_SOFT_DIR}/dcm2niix/build/bin:\
${NEW_SOFT_DIR}/mrtrix3/bin:\
${NEW_SOFT_DIR}/cmake-3.14.2-Linux-x86_64/bin:\
${NEW_SOFT_DIR}/git-lfs/bin:\
${NEW_SOFT_DIR}/bin:\
${NEW_SOFT_DIR}/HD-BET/HD_BET
#${NEW_SOFT_DIR}/cuda-9.1/bin:\
#${NEW_SOFT_DIR}/CNN-Diffusion-MRIBrain-Segmentation/pipeline/:\

# activate miniconda3
#source ${NEW_SOFT_DIR}/miniconda3/etc/profile.d/conda.sh
source ~/anaconda3/etc/profile.d/conda.sh
# activate pnlpipe
export PNLPIPE_SOFT=${NEW_SOFT_DIR}/pnlpipe/soft_dir/
conda activate tf1.15

# activate fsl 6.0.1, must activate fsl first so FSLDIR is set properly for FreeSurfer
#source ${NEW_SOFT_DIR}/fsl/activate.sh


# route FreeSurfer output outside installation folder
export SUBJECTS_DIR=/rfanfs/pnl-zorro/FS_SUBJECTS_DIR
# activate freesurfer 7.1.0
source ${NEW_SOFT_DIR}/fs7.1.0/activate.sh > /dev/null 2>&1

# source BRAINSTools
source ${PNLPIPE_SOFT}/BRAINSTools-bin-81a409d/env.sh

# source ANTs
source ${PNLPIPE_SOFT}/ANTs-bin-ca32228/env.sh

# source tract querier
source ${PNLPIPE_SOFT}/tract_querier-d4a88aa/env.sh

# source tractography
source ${PNLPIPE_SOFT}/UKFTractography-fcf83e2/env.sh

# append LD_LIBRARY_PATH
export LD_LIBRARY_PATH=${CONDA_PREFIX}/lib/:\
${NEW_SOFT_DIR}/cuda-9.1/lib64/:${LD_LIBRARY_PATH}

# SlicerWithExtensions
#alias Slicer=${NEW_SOFT_DIR}/Slicer-4.10.2-linux-amd64/SlicerWithExtensions.sh
#alias s10=${NEW_SOFT_DIR}/Slicer-4.10.2-linux-amd64/SlicerWithExtensions.sh

# define temporary directory for pnlpipe and pnlNipype
export PNLPIPE_TMPDIR=$HOME/tmp/

# define PYTHONPATH for luigi-pnlpipe
#export PYTHONPATH=${NEW_SOFT_DIR}/luigi-pnlpipe/:$PYTHONPATH

# MATLAB/2017a
export PATH=/rfanfs/pnl-zorro/software/MATLAB/R2017a/bin:$PATH

# library path for R
export PATH=${NEW_SOFT_DIR}/R-3.5.1/bin:$PATH
unset R_HOME
export R_LIBS_USER=${NEW_SOFT_DIR}/R/x86_64-pc-linux-gnu-library/3.5.1


# singularity
export SINGULARITY_BIND=/rfanfs/pnl-zorro/:/rfanfs/pnl-zorro/,/projects/:/projects/

# Luigi authentication
export LUIGI_USERNAME=pnlbwh
export LUIGI_PASSWORD=Luigi_Pnl

# required for @update.afni.binaries
export PATH=$PATH:${NEW_SOFT_DIR}/afnibin

# set up tab completion for AFNI programs
if [ -f ${NEW_SOFT_DIR}/.afni/help/all_progs.COMP.bash ]
then
   source ${NEW_SOFT_DIR}/.afni/help/all_progs.COMP.bash
fi

# allow group write permission
umask 0007

#export PYTHONPATH=${NEW_SOFT_DIR}/HD-BET/:$PYTHONPATH
